# EasyTask 测试指导文档

## 文档版本
- 版本：v1.0.0
- 创建日期：2025-12-31
- 适用项目：EasyTask（前后端分离项目）

---

## 一、项目概述

### 1.1 项目技术栈

**后端技术栈**
- 框架：SpringBoot 2.7.18
- 数据库：PostgreSQL
- 安全认证：Spring Security + JWT
- ORM框架：Spring Data JPA
- API文档：Swagger 2.9.2 + Knife4j 3.0.3
- 日志框架：Logback
- Java版本：JDK 11

**前端技术栈**
- 框架：Vue 3.3.4
- 构建工具：Vite 5.0.8
- UI组件库：Element Plus 2.4.4
- 状态管理：Pinia 2.1.7
- 路由：Vue Router 4.2.5
- HTTP客户端：Axios 1.6.2

### 1.2 已实现功能模块

根据当前项目结构，已完成以下功能：

1. **项目初始化**
   - 后端Maven项目结构
   - 前端Vue3项目结构

2. **认证授权模块**
   - JWT用户认证
   - 登录接口（`/api/auth/login`）
   - JWT Token生成与验证
   - Spring Security配置

3. **AI配置模块**
   - AI API参数配置（通过application.yml）
   - AiClientConfig配置类

4. **API文档模块**
   - Swagger集成
   - Knife4j增强UI

5. **基础功能**
   - 全局异常处理
   - 统一日志管理（Logback）
   - 前后端跨域配置（CORS）

---

## 二、测试机制说明

### 2.1 后端测试框架

#### 2.1.1 核心测试框架

**Spring Boot Test**（已集成）
- 提供完整的Spring Boot应用测试支持
- 包含JUnit 5、Mockito、AssertJ等测试库

**Spring Security Test**（已集成）
- 专门用于Spring Security安全测试
- 提供认证和授权测试支持

#### 2.1.2 测试类型支持

1. **单元测试（Unit Test）**
   - 测试单个类或方法
   - 使用Mock模拟依赖
   - 快速执行，不依赖外部资源

2. **集成测试（Integration Test）**
   - 测试多个组件协作
   - 可使用内存数据库（H2）
   - 测试完整的数据流

3. **Web层测试（Web Layer Test）**
   - 使用`@WebMvcTest`测试Controller
   - 模拟HTTP请求和响应
   - 验证API接口行为

4. **安全测试（Security Test）**
   - 测试认证和授权逻辑
   - 验证JWT Token验证
   - 测试权限控制

#### 2.1.3 测试目录结构

```
backend/src/test/java/com/eztask/
├── controller/          # Controller层测试
├── service/            # Service层测试
├── security/           # 安全认证测试
├── util/               # 工具类测试
├── config/             # 配置类测试
└── integration/        # 集成测试
```

### 2.2 前端测试框架（待配置）

#### 2.2.1 推荐测试框架

**Vitest**（推荐）
- Vite原生支持的测试框架
- 速度快，配置简单
- 与Vite完美集成

**Vue Test Utils**
- Vue官方组件测试工具
- 提供组件挂载和交互能力

**Vitest DOM**
- DOM断言库
- 简化DOM元素验证

#### 2.2.2 需要安装的依赖

```json
{
  "devDependencies": {
    "vitest": "^1.0.0",
    "@vue/test-utils": "^2.4.0",
    "@vitest/ui": "^1.0.0",
    "jsdom": "^23.0.0"
  }
}
```

#### 2.2.3 测试类型支持

1. **组件测试（Component Test）**
   - 测试Vue组件渲染
   - 验证用户交互
   - 检查事件触发

2. **单元测试（Unit Test）**
   - 测试工具函数
   - 测试Pinia store
   - 测试路由逻辑

3. **E2E测试（End-to-End Test）**
   - 完整用户流程测试
   - 需要Playwright或Cypress

---

## 三、可用的测试能力

### 3.1 后端测试能力

#### 3.1.1 Controller层测试

**测试目标**
- 验证API接口的正确性
- 测试HTTP请求和响应
- 验证异常处理

**测试工具**
- `@WebMvcTest`：只加载Web层
- `MockMvc`：模拟HTTP请求
- `@MockBean`：模拟Service层

**示例场景**
```java
@WebMvcTest(AuthController.class)
public class AuthControllerTest {
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private AuthService authService;
    
    @Test
    public void testLoginSuccess() throws Exception {
        mockMvc.perform(post("/api/auth/login")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"username\":\"admin\",\"password\":\"password\"}"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.token").exists());
    }
}
```

#### 3.1.2 Security层测试

**测试目标**
- 验证JWT Token生成
- 测试权限控制
- 验证认证过滤器

**测试工具**
- `@WithMockUser`：模拟认证用户
- `@WithSecurityContext`：自定义安全上下文
- `JwtTokenUtil`：JWT工具类测试

**示例场景**
```java
@SpringBootTest
public class JwtTokenUtilTest {
    @Autowired
    private JwtTokenUtil jwtTokenUtil;
    
    @Test
    public void testGenerateToken() {
        String token = jwtTokenUtil.generateToken("admin");
        assertNotNull(token);
        assertTrue(jwtTokenUtil.validateToken(token, "admin"));
    }
}
```

#### 3.1.3 Service层测试

**测试目标**
- 测试业务逻辑
- 验证数据处理
- 测试异常情况

**测试工具**
- `@ExtendWith(MockitoExtension.class)`：Mockito支持
- `@Mock`：模拟依赖
- `@InjectMocks`：注入Mock对象

#### 3.1.4 集成测试

**测试目标**
- 测试完整功能流程
- 验证数据库操作
- 测试配置加载

**测试工具**
- `@SpringBootTest`：加载完整应用上下文
- `@TestConfiguration`：测试专用配置
- `@AutoConfigureTestDatabase`：自动配置测试数据库

**配置建议**
```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
  jpa:
    hibernate:
      ddl-auto: create-drop
```

### 3.2 前端测试能力

#### 3.2.1 组件测试

**测试目标**
- 验证组件渲染
- 测试用户交互
- 检查props和emits

**测试工具**
- `mount()`：挂载组件
- `wrapper.find()`：查找元素
- `wrapper.trigger()`：触发事件

**示例场景**
```javascript
import { mount } from '@vue/test-utils'
import Login from '@/views/Login.vue'

describe('Login.vue', () => {
  it('renders login form', () => {
    const wrapper = mount(Login)
    expect(wrapper.find('form').exists()).toBe(true)
  })
  
  it('emits login event', async () => {
    const wrapper = mount(Login)
    await wrapper.find('button').trigger('click')
    expect(wrapper.emitted('login')).toBeTruthy()
  })
})
```

#### 3.2.2 Pinia Store测试

**测试目标**
- 测试状态管理
- 验证action和getter
- 测试持久化

**测试工具**
- `createPinia()`：创建Pinia实例
- `setActivePinia()`：激活Pinia

**示例场景**
```javascript
import { setActivePinia, createPinia } from 'pinia'
import { useUserStore } from '@/stores/user'

describe('User Store', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })
  
  it('sets user token', () => {
    const store = useUserStore()
    store.setToken('test-token')
    expect(store.token).toBe('test-token')
  })
})
```

#### 3.2.3 API测试

**测试目标**
- 测试API调用
- 验证请求拦截器
- 测试错误处理

**测试工具**
- `vi.mock()`：模拟Axios
- `vi.fn()`：创建模拟函数

**示例场景**
```javascript
import { login } from '@/api/auth'
import axios from 'axios'

vi.mock('axios')

describe('Auth API', () => {
  it('calls login endpoint', async () => {
    axios.post.mockResolvedValue({ data: { token: 'test' } })
    const result = await login({ username: 'admin', password: 'pass' })
    expect(axios.post).toHaveBeenCalledWith('/api/auth/login', expect.any(Object))
  })
})
```

---

## 四、测试用例编写规范

### 4.1 后端测试规范

#### 4.1.1 命名规范

**测试类命名**
- 格式：`{被测类名}Test`
- 示例：`AuthControllerTest`、`JwtTokenUtilTest`

**测试方法命名**
- 格式：`test{功能描述}+{预期结果}`
- 示例：`testLoginSuccess`、`testGenerateToken`

#### 4.1.2 注解使用

```java
@SpringBootTest                       // 完整集成测试
@WebMvcTest(AuthController.class)    // Web层测试
@ExtendWith(MockitoExtension.class)  // Mockito支持
@MockBean                            // Mock Spring Bean
@Mock                                // Mockito Mock对象
@InjectMocks                         // 注入Mock对象
@TestConfiguration                  // 测试配置
@WithMockUser                        // 模拟认证用户
```

#### 4.1.3 测试结构

每个测试方法应遵循AAA模式：
- **Arrange（准备）**：准备测试数据和Mock对象
- **Act（执行）**：执行被测代码
- **Assert（断言）**：验证结果

```java
@Test
public void testLoginSuccess() throws Exception {
    // Arrange - 准备
    LoginRequest request = new LoginRequest("admin", "password");
    LoginResponse response = new LoginResponse("test-token");
    when(authService.login(any())).thenReturn(response);
    
    // Act - 执行
    MvcResult result = mockMvc.perform(post("/api/auth/login")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
        .andReturn();
    
    // Assert - 断言
    assertThat(result.getResponse().getStatus()).isEqualTo(200);
    assertThat(result.getResponse().getContentAsString())
        .contains("test-token");
}
```

#### 4.1.4 断言规范

使用AssertJ进行断言（Spring Boot Test已集成）：

```java
import static org.assertj.core.api.Assertions.*;

assertThat(user.getUsername()).isEqualTo("admin");
assertThat(user.getRoles()).hasSize(2);
assertThat(token).isNotNull();
assertThat(exception).isInstanceOf(BusinessException.class);
```

#### 4.1.5 测试覆盖率目标

| 测试类型 | 覆盖率目标 |
|---------|-----------|
| 单元测试 | ≥ 80% |
| 集成测试 | ≥ 60% |
| 总体覆盖率 | ≥ 70% |

### 4.2 前端测试规范

#### 4.2.1 命名规范

**测试文件命名**
- 格式：`{组件名}.spec.js` 或 `{组件名}.test.js`
- 示例：`Login.spec.js`、`user.test.js`

**测试描述命名**
- 格式：`{功能描述} should {预期行为}`
- 示例：`Login component should render login form`

#### 4.2.2 测试结构

```javascript
describe('ComponentName', () => {
  // 全局setup
  beforeEach(() => {
    // 准备工作
  })
  
  // 全局teardown
  afterEach(() => {
    // 清理工作
  })
  
  // 测试用例组
  describe('功能模块', () => {
    it('should 正常行为', () => {
      // Arrange
      const wrapper = mount(Component)
      
      // Act
      await wrapper.find('button').trigger('click')
      
      // Assert
      expect(wrapper.emitted('event')).toBeTruthy()
    })
  })
})
```

#### 4.2.3 断言规范

```javascript
import { expect } from 'vitest'

expect(wrapper.text()).toContain('Hello')
expect(store.count).toBe(5)
expect(array).toHaveLength(3)
expect(promise).resolves.toBe('result')
expect(error).rejects.toThrow()
```

#### 4.2.4 测试覆盖率目标

| 测试类型 | 覆盖率目标 |
|---------|-----------|
| 组件测试 | ≥ 70% |
| 工具函数测试 | ≥ 90% |
| 总体覆盖率 | ≥ 65% |

---

## 五、测试执行流程

### 5.1 后端测试执行

#### 5.1.1 执行所有测试

**Maven命令**
```bash
# 进入后端目录
cd backend

# 执行所有测试
mvn test

# 执行测试并生成覆盖率报告
mvn test jacoco:report
```

**IDE执行**
- IntelliJ IDEA：右键测试类 → Run 'xxxTest'
- Eclipse：右键测试类 → Run As → JUnit Test

#### 5.1.2 执行指定测试

```bash
# 执行单个测试类
mvn test -Dtest=AuthControllerTest

# 执行单个测试方法
mvn test -Dtest=AuthControllerTest#testLoginSuccess

# 执行匹配的测试类
mvn test -Dtest=*ControllerTest
```

#### 5.1.3 测试配置

**激活测试环境**
```bash
# 使用test profile
mvn test -Dspring.profiles.active=test
```

**跳过测试**
```bash
# 编译时跳过测试
mvn clean install -DskipTests

# 执行时跳过测试
mvn clean package -Dmaven.test.skip=true
```

#### 5.1.4 查看测试结果

**控制台输出**
```
Tests run: 10, Failures: 0, Errors: 0, Skipped: 0
```

**测试报告位置**
```
backend/target/surefire-reports/
backend/target/site/jacoco/index.html  # 覆盖率报告
```

### 5.2 前端测试执行（需先配置）

#### 5.2.1 安装测试依赖

```bash
# 进入前端目录
cd frontend

# 安装测试依赖
npm install -D vitest @vue/test-utils @vitest/ui jsdom
```

#### 5.2.2 配置Vitest

**在 `vite.config.js` 中添加配置**
```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html']
    }
  }
})
```

**在 `package.json` 中添加测试脚本**
```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  }
}
```

#### 5.2.3 执行测试

```bash
# 执行所有测试
npm run test

# 执行测试并打开UI界面
npm run test:ui

# 执行测试并生成覆盖率报告
npm run test:coverage

# 监听模式（文件变化自动执行）
npm run test -- --watch
```

#### 5.2.4 查看测试结果

**控制台输出**
```
Test Files  5 passed (5)
     Tests  12 passed (12)
  Start at  14:30:00
  Duration  2.45s
```

**覆盖率报告**
```
frontend/coverage/index.html
```

### 5.3 测试最佳实践

#### 5.3.1 通用原则

1. **测试独立性**
   - 每个测试用例应该独立运行
   - 不依赖其他测试用例的执行顺序
   - 使用`@BeforeEach`或`beforeEach`准备测试数据

2. **测试可读性**
   - 使用清晰的测试名称
   - 添加必要的注释
   - 遵循AAA模式

3. **测试速度**
   - 单元测试应该快速执行
   - 使用Mock避免外部依赖
   - 集成测试可以慢一些，但要控制数量

4. **测试维护**
   - 定期更新测试用例
   - 删除过时的测试
   - 保持测试代码质量

#### 5.3.2 后端最佳实践

1. **使用测试配置**
```java
@TestConfiguration
public class TestConfig {
    @Bean
    @Primary
    public DataSource testDataSource() {
        return new EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.H2)
            .build();
    }
}
```

2. **Mock外部服务**
```java
@MockBean
private RestTemplate restTemplate;

@Test
public void testCallExternalApi() {
    when(restTemplate.getForObject(anyString(), eq(String.class)))
        .thenReturn("mocked response");
}
```

3. **测试异常情况**
```java
@Test
public void testLoginWithInvalidCredentials() {
    LoginRequest request = new LoginRequest("wrong", "wrong");
    when(authService.login(any()))
        .thenThrow(new BusinessException("Invalid credentials"));
    
    mockMvc.perform(post("/api/auth/login")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request)))
        .andExpect(status().isBadRequest());
}
```

#### 5.3.3 前端最佳实践

1. **组件隔离测试**
```javascript
import { config } from '@vue/test-utils'

config.global.stubs = {
  'router-link': true,
  'router-view': true
}
```

2. **Mock API调用**
```javascript
vi.mock('@/api/auth', () => ({
  login: vi.fn()
}))
```

3. **测试异步操作**
```javascript
it('handles async operation', async () => {
  const wrapper = mount(Component)
  await wrapper.vm.loadData()
  await wrapper.vm.$nextTick()
  expect(wrapper.vm.data).toHaveLength(5)
})
```

---

## 六、测试环境配置

### 6.1 后端测试环境配置

#### 6.1.1 测试配置文件

**创建 `backend/src/main/resources/application-test.yml`**
```yaml
spring:
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
    show-sql: true

  # 禁用AI配置
  ai:
    api:
      enabled: false

# JWT配置（测试用）
jwt:
  secret: TestSecretKeyForTestingPurposeOnly
  expiration: 3600000  # 1小时

# 日志配置
logging:
  level:
    com.eztask: DEBUG
    org.springframework.security: DEBUG
```

#### 6.1.2 测试数据库依赖

**在 `pom.xml` 中添加H2数据库**
```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>test</scope>
</dependency>
```

#### 6.1.3 测试数据准备

**使用SQL脚本初始化数据**
```sql
-- backend/src/test/resources/schema.sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL
);

INSERT INTO users (username, password) VALUES 
('admin', '$2a$10$encodedPassword'),
('user', '$2a$10$encodedPassword');
```

**使用TestDataBuilder模式**
```java
public class UserTestDataBuilder {
    private User user = new User();
    
    public static UserTestDataBuilder aUser() {
        return new UserTestDataBuilder();
    }
    
    public UserTestDataBuilder withUsername(String username) {
        user.setUsername(username);
        return this;
    }
    
    public UserTestDataBuilder withPassword(String password) {
        user.setPassword(password);
        return this;
    }
    
    public User build() {
        return user;
    }
}
```

### 6.2 前端测试环境配置

#### 6.2.1 测试环境变量

**创建 `.env.test`**
```env
VITE_API_BASE_URL=http://localhost:8080/api
VITE_APP_TITLE=EasyTask (Test)
```

#### 6.2.2 Vitest配置文件

**创建 `vitest.config.js`**
```javascript
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import { fileURLToPath } from 'node:url'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.js'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: [
        'node_modules/',
        'src/test/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/mockData'
      ]
    }
  },
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  }
})
```

#### 6.2.3 测试初始化文件

**创建 `src/test/setup.js`**
```javascript
import { vi } from 'vitest'
import { config } from '@vue/test-utils'

// Mock router
vi.mock('vue-router', () => ({
  useRouter: () => ({
    push: vi.fn(),
    replace: vi.fn(),
    currentRoute: { value: {} }
  }),
  useRoute: () => ({})
}))

// Global stubs
config.global.stubs = {
  'router-link': true,
  'router-view': true
}

// Global mocks
config.global.mocks = {
  $t: (key) => key
}
```

---

## 七、测试报告与覆盖率

### 7.1 后端测试报告

#### 7.1.1 添加JaCoCo插件

**在 `pom.xml` 中添加**
```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.jacoco</groupId>
            <artifactId>jacoco-maven-plugin</artifactId>
            <version>0.8.10</version>
            <executions>
                <execution>
                    <goals>
                        <goal>prepare-agent</goal>
                    </goals>
                </execution>
                <execution>
                    <id>report</id>
                    <phase>test</phase>
                    <goals>
                        <goal>report</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

#### 7.1.2 生成报告

```bash
# 执行测试并生成报告
mvn clean test jacoco:report

# 查看报告
# 打开 backend/target/site/jacoco/index.html
```

#### 7.1.3 报告解读

- **指令覆盖率（Instruction Coverage）**：执行的字节码百分比
- **分支覆盖率（Branch Coverage）**：if/else分支覆盖情况
- **行覆盖率（Line Coverage）**：执行的代码行百分比
- **方法覆盖率（Method Coverage）**：执行的方法百分比
- **类覆盖率（Class Coverage）**：执行的类百分比

### 7.2 前端测试报告

#### 7.2.1 生成覆盖率报告

```bash
# 生成覆盖率报告
npm run test:coverage

# 查看报告
# 打开 frontend/coverage/index.html
```

#### 7.2.2 报告解读

- **Statements**：语句覆盖率
- **Branches**：分支覆盖率
- **Functions**：函数覆盖率
- **Lines**：行覆盖率

---

## 八、测试检查清单

### 8.1 后端测试检查清单

- [ ] 单元测试覆盖核心业务逻辑
- [ ] Controller层测试所有API接口
- [ ] Security层测试认证和授权
- [ ] 异常处理测试各种异常情况
- [ ] 集成测试测试完整流程
- [ ] 测试覆盖率 ≥ 70%
- [ ] 所有测试都能独立运行
- [ ] 测试运行时间在合理范围内
- [ ] 测试代码遵循编码规范
- [ ] 关键功能有完整的测试用例

### 8.2 前端测试检查清单

- [ ] 组件测试覆盖核心组件
- [ ] Store测试覆盖所有状态管理
- [ ] API测试覆盖所有接口调用
- [ ] 路由测试覆盖主要路由
- [ ] 工具函数测试覆盖所有函数
- [ ] 测试覆盖率 ≥ 65%
- [ ] 所有测试都能独立运行
- [ ] 异步操作正确处理
- [ ] 用户交互测试完整
- [ ] 错误处理测试充分

---

## 九、常见问题与解决方案

### 9.1 后端常见问题

#### 问题1：测试时数据库连接失败

**解决方案**
```java
@SpringBootTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
@TestPropertySource(locations = "classpath:application-test.yml")
public class YourTest {
    // 测试代码
}
```

#### 问题2：Mock对象不生效

**解决方案**
- 确保使用`@MockBean`而不是`@Mock`（Spring Bean）
- 检查是否正确导入Mockito注解
- 使用`@ExtendWith(MockitoExtension.class)`

#### 问题3：JWT Token验证失败

**解决方案**
```java
@BeforeEach
public void setup() {
    SecurityContextHolder.clearContext();
}

@AfterEach
public void cleanup() {
    SecurityContextHolder.clearContext();
}
```

### 9.2 前端常见问题

#### 问题1：组件挂载失败

**解决方案**
```javascript
import { config } from '@vue/test-utils'

config.global.stubs = {
  组件名: true  // Stub掉依赖的组件
}
```

#### 问题2：异步测试失败

**解决方案**
```javascript
it('async test', async () => {
  await wrapper.vm.asyncMethod()
  await wrapper.vm.$nextTick()  // 等待DOM更新
  expect(wrapper.vm.data).toBe('expected')
})
```

#### 问题3：Pinia store测试失败

**解决方案**
```javascript
import { createPinia, setActivePinia } from 'pinia'

beforeEach(() => {
  setActivePinia(createPinia())
})
```

---

## 十、测试资源与参考

### 10.1 后端测试资源

- [Spring Boot Test官方文档](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.testing)
- [Spring Security Test文档](https://docs.spring.io/spring-security/reference/servlet/test/index.html)
- [JUnit 5用户指南](https://junit.org/junit5/docs/current/user-guide/)
- [Mockito文档](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html)
- [AssertJ文档](https://assertj.github.io/doc/)

### 10.2 前端测试资源

- [Vitest官方文档](https://vitest.dev/)
- [Vue Test Utils文档](https://test-utils.vuejs.org/)
- [Vitest DOM](https://github.com/vitest-dev/vitest/tree/main/packages/vitest-dom)
- [Pinia测试指南](https://pinia.vuejs.org/cookbook/testing.html)
- [Vue.js测试最佳实践](https://vuejs.org/guide/scaling-up/testing.html)

### 10.3 项目内部资源

- 后端测试目录：`backend/src/test/`
- 前端测试目录：`frontend/src/test/`（待创建）
- API文档：`http://localhost:8080/api/doc.html`（Knife4j）
- 测试配置：`backend/src/main/resources/application-test.yml`（待创建）

---

## 附录

### A. 测试模板

#### A.1 后端测试模板

```java
package com.eztask.controller;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.beans.factory.annotation.Autowired;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;
import static org.assertj.core.api.Assertions.assertThat;

@WebMvcTest(AuthController.class)
@ExtendWith(MockitoExtension.class)
public class AuthControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Mock
    private AuthService authService;
    
    @InjectMocks
    private AuthController authController;
    
    @BeforeEach
    public void setup() {
        // 测试初始化
    }
    
    @Test
    public void testLoginSuccess() throws Exception {
        // Arrange
        LoginRequest request = new LoginRequest("admin", "password");
        LoginResponse response = new LoginResponse("test-token");
        when(authService.login(any())).thenReturn(response);
        
        // Act & Assert
        mockMvc.perform(post("/api/auth/login")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"username\":\"admin\",\"password\":\"password\"}"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.token").value("test-token"));
    }
}
```

#### A.2 前端测试模板

```javascript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import Login from '@/views/Login.vue'

describe('Login.vue', () => {
  let wrapper
  
  beforeEach(() => {
    wrapper = mount(Login)
  })
  
  afterEach(() => {
    wrapper.unmount()
  })
  
  describe('组件渲染', () => {
    it('should render login form', () => {
      expect(wrapper.find('form').exists()).toBe(true)
      expect(wrapper.find('input[type="text"]').exists()).toBe(true)
      expect(wrapper.find('input[type="password"]').exists()).toBe(true)
    })
  })
  
  describe('用户交互', () => {
    it('should emit login event on button click', async () => {
      await wrapper.find('button').trigger('click')
      expect(wrapper.emitted('login')).toBeTruthy()
    })
  })
  
  describe('数据验证', () => {
    it('should validate empty username', async () => {
      await wrapper.setData({ username: '', password: '123456' })
      await wrapper.find('button').trigger('click')
      expect(wrapper.vm.errors.username).toBeTruthy()
    })
  })
})
```

### B. 测试命令速查表

#### 后端测试命令

| 命令 | 说明 |
|-----|------|
| `mvn test` | 执行所有测试 |
| `mvn test -Dtest=ClassName` | 执行指定测试类 |
| `mvn test -Dtest=ClassName#methodName` | 执行指定测试方法 |
| `mvn clean test jacoco:report` | 执行测试并生成覆盖率报告 |
| `mvn test -DskipTests` | 跳过测试 |

#### 前端测试命令

| 命令 | 说明 |
|-----|------|
| `npm run test` | 执行所有测试 |
| `npm run test:ui` | 执行测试并打开UI |
| `npm run test:coverage` | 执行测试并生成覆盖率报告 |
| `npm run test -- --watch` | 监听模式 |
| `npm run test -- --run` | 单次运行模式 |

---

**文档结束**

如有疑问或需要补充，请联系项目团队。